# Quick Start Guide: Xcode Project Rebuilder

## Overview

This guide will help you rebuild your Xcode project with proper organization in just a few steps.

## Prerequisites

Before you begin, ensure you have:

1. Python 3.7 or later installed
2. Your Xcode project backed up or committed to Git
3. Two JSON files (created by analysis agents):
   - `project_analysis.json` - Analysis of current project structure
   - `group_structure.json` - Desired new organization

## Step-by-Step Process

### Step 1: Verify Your Project Location

```bash
cd /Users/iesouskurios/omniTAK-mobile/apps/omnitak
```

### Step 2: Check for Required Files

```bash
# You should have these files in the project directory:
ls -la project_analysis.json group_structure.json

# If they don't exist, you need to run the analysis agents first
# (These should be created by separate analysis/planning scripts)
```

### Step 3: Run the Rebuilder (Safe Mode - Test First)

```bash
# This will create a temporary file without modifying the original
python3 rebuild_project.py OmniTAKMobile.xcodeproj
```

Expected output:
```
============================================================
Xcode Project Rebuilder
============================================================

Loading analysis from: project_analysis.json
  - Loaded XXX file references
  - Loaded XXX build files
  - Loaded XXX groups

Loading group structure from: group_structure.json
  - Loaded group structure with X top-level groups

Building file reference map...
  - Mapped XXX file paths to references

Building file reference to build file map...
  - Mapped XXX file references to build files

Creating groups from structure...
  - Created XXX groups

Generating project.pbxproj content...

Validating generated project...
  - Validation passed!

Writing project to: project.pbxproj.new.20251123_220000
  - Wrote XXXXXX characters
  - File size: XXX,XXX bytes

============================================================
Rebuild completed successfully!
============================================================

New project file: project.pbxproj.new.20251123_220000

Next steps:
  1. Review the new project file
  2. Test it by opening in Xcode
  3. If successful, replace the original:
     cp project.pbxproj.new.20251123_220000 OmniTAKMobile.xcodeproj/project.pbxproj
```

### Step 4: Review the Generated File

```bash
# Check the file was created
ls -lh OmniTAKMobile.xcodeproj/project.pbxproj*

# Verify critical settings are present
grep -c "com.engindearing.omnitak.mobile" project.pbxproj.new.*
grep -c "4HSANV485G" project.pbxproj.new.*
grep -c "1.3.8" project.pbxproj.new.*
```

All three commands should return a number greater than 0.

### Step 5: Test in Xcode (IMPORTANT!)

```bash
# Create a test backup of your entire project
cp -r OmniTAKMobile.xcodeproj OmniTAKMobile.xcodeproj.backup

# Copy the new file to the project
cp project.pbxproj.new.* OmniTAKMobile.xcodeproj/project.pbxproj

# Open in Xcode
open OmniTAKMobile.xcodeproj
```

**In Xcode, verify:**
- [ ] All files appear in the navigator (no red references)
- [ ] Files are organized in the correct groups
- [ ] Project builds successfully (Cmd+B)
- [ ] All targets are present
- [ ] Build settings are correct (check General tab)
- [ ] Signing & Capabilities are preserved

### Step 6: Test Build

```bash
# Clean build
# In Xcode: Shift+Cmd+K

# Build
# In Xcode: Cmd+B

# Run on simulator
# In Xcode: Cmd+R
```

### Step 7: If Successful, Clean Up

```bash
# If everything works, you can remove the backup
rm -rf OmniTAKMobile.xcodeproj.backup

# And clean up the temporary files
rm project.pbxproj.new.*
```

## Troubleshooting

### Missing Input Files

**Problem:** `FileNotFoundError: Analysis file not found`

**Solution:** You need to create the analysis files first. These should be generated by separate analysis agents.

### Validation Errors

**Problem:** Script reports validation errors

**Solution:**
1. Check the error messages carefully
2. Verify your `project_analysis.json` is complete
3. Verify your `group_structure.json` is properly formatted
4. See the detailed README for more troubleshooting steps

### Xcode Shows Red References

**Problem:** Some files appear red (missing) in Xcode

**Solution:**
1. The files may not be in the `group_structure.json`
2. Check the file paths are correct
3. Verify the files actually exist on disk

### Build Fails

**Problem:** Project doesn't build after rebuild

**Solution:**
1. Compare build settings with the original project
2. Check that all source files are in the Sources build phase
3. Verify framework linking is correct
4. Restore from backup and investigate the differences

## Recovery

### If Something Goes Wrong

#### Option 1: Restore from Backup
```bash
rm OmniTAKMobile.xcodeproj/project.pbxproj
cp OmniTAKMobile.xcodeproj.backup/project.pbxproj OmniTAKMobile.xcodeproj/
```

#### Option 2: Use Git
```bash
git checkout -- OmniTAKMobile.xcodeproj/project.pbxproj
```

#### Option 3: Use Automatic Backup
If you used `--replace`, a backup was created:
```bash
ls -t OmniTAKMobile.xcodeproj/project.pbxproj.backup.* | head -1
# Copy the most recent backup
```

## Advanced Usage

### Replace Original Directly (Creates Automatic Backup)

```bash
python3 rebuild_project.py OmniTAKMobile.xcodeproj --replace
```

This will:
1. Create `project.pbxproj.backup.TIMESTAMP`
2. Replace the original `project.pbxproj`

### Custom Input Files

```bash
python3 rebuild_project.py OmniTAKMobile.xcodeproj \
  --analysis /path/to/custom_analysis.json \
  --structure /path/to/custom_structure.json
```

### Custom Output Location

```bash
python3 rebuild_project.py OmniTAKMobile.xcodeproj \
  --output /tmp/test_project.pbxproj
```

## Best Practices

1. **Always Commit First**: Make sure your project is committed to Git before running
2. **Test in Safe Mode First**: Use the default behavior to create a temporary file
3. **Verify in Xcode**: Always open and inspect the project in Xcode
4. **Test Build**: Perform a clean build before committing changes
5. **Keep Backups**: Don't delete backups until you're certain everything works

## What Gets Preserved

The rebuilder preserves all critical settings:

- ‚úÖ Bundle ID: `com.engindearing.omnitak.mobile`
- ‚úÖ Team ID: `4HSANV485G`
- ‚úÖ Marketing Version: `1.3.8`
- ‚úÖ Current Project Version: `1.3.8`
- ‚úÖ All build phases
- ‚úÖ All build configurations (Debug/Release)
- ‚úÖ All compiler flags and settings
- ‚úÖ Framework search paths
- ‚úÖ Info.plist settings
- ‚úÖ Capabilities and entitlements
- ‚úÖ Code signing configuration

## What Gets Changed

Only the organization changes:

- üìÅ Group hierarchy (folders in Xcode)
- üìÅ File placement within groups
- üìÅ Group names and structure

The actual files on disk are **not moved or modified**.

## Getting Help

1. Read the detailed [README](REBUILD_PROJECT_README.md)
2. Check the [example files](project_analysis.example.json)
3. Review error messages carefully
4. Compare the generated file with the original

## Example Workflow

Here's a complete example workflow:

```bash
# 1. Navigate to project directory
cd /Users/iesouskurios/omniTAK-mobile/apps/omnitak

# 2. Verify you have the required files
ls project_analysis.json group_structure.json

# 3. Create a Git commit (safety)
git add -A
git commit -m "Backup before project reorganization"

# 4. Run the rebuilder
python3 rebuild_project.py OmniTAKMobile.xcodeproj

# 5. Test the new file
cp project.pbxproj.new.* test_project.pbxproj

# 6. Make a temporary backup
cp -r OmniTAKMobile.xcodeproj OmniTAKMobile.xcodeproj.test

# 7. Apply the new file
cp test_project.pbxproj OmniTAKMobile.xcodeproj.test/project.pbxproj

# 8. Open in Xcode
open OmniTAKMobile.xcodeproj.test

# 9. If successful, apply to real project
cp test_project.pbxproj OmniTAKMobile.xcodeproj/project.pbxproj

# 10. Clean up
rm -rf OmniTAKMobile.xcodeproj.test
rm test_project.pbxproj project.pbxproj.new.*

# 11. Commit the changes
git add OmniTAKMobile.xcodeproj/project.pbxproj
git commit -m "Reorganize project structure"
```

## Time Estimates

- Small project (< 100 files): 1-2 seconds
- Medium project (100-500 files): 2-5 seconds
- Large project (500-1000 files): 5-15 seconds
- Very large project (1000+ files): 15-60 seconds

## Next Steps

After successfully rebuilding your project:

1. Commit the changes to Git
2. Share the new structure with your team
3. Update any documentation that references file locations
4. Consider running the rebuilder periodically to maintain organization

---

**Questions?** Review the detailed [README](REBUILD_PROJECT_README.md) for more information.
